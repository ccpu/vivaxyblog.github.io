<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0">
    <link rel="shortcut icon" href="/css/vivaxy.icon.png">
    <link type="text/css" rel="stylesheet" href="/css/reset.css">
    <link type="text/css" rel="stylesheet" href="/css/main.css">
    <link type="text/css" rel="stylesheet" href="/css/syntax.css">
    <link rel="alternate" type="application/atom+xml" title="vivaxy blog" href="/atom.xml"/>
    <title>Node Gyp Rebuild Too Slow</title>
</head>
<body>
<div class="container">
    <a href="/" class="card hover-left">
    <div class="content">
        <h1>Node Gyp Rebuild Too Slow</h1>
        <div class="date">2015-11-25</div>
    </div>
    <div class="icon-arrow-left"></div>
</a>
<div class="card">
    <div class="content">
        <p>In China, node-gyp always building too slow or failing because of connection.</p>

<p>We can fix it by executing a shell script.</p>

<div class="highlight"><pre><code class="language-sh" data-lang="sh"><span class="c">#!/usr/bin/env bash</span>

<span class="c"># 获得 nodejs 版本号</span>
<span class="nv">NODE_VERSION</span><span class="o">=</span><span class="sb">`</span>node -v <span class="p">|</span> cut -d<span class="s1">&#39;v&#39;</span> -f 2<span class="sb">`</span>

<span class="c"># 下载源码包</span>
curl -L https://npm.taobao.org/mirrors/node/v<span class="nv">$NODE_VERSION</span>/node-v<span class="nv">$NODE_VERSION</span>.tar.gz -o node-v<span class="nv">$NODE_VERSION</span>.tar.gz

<span class="c"># 删除现有内容不完整的目录</span>
rm -rf ~/.node-gyp
mkdir ~/.node-gyp

<span class="c"># 解压缩并重命名到正确格式</span>
tar zxf node-v<span class="nv">$NODE_VERSION</span>.tar.gz -C ~/.node-gyp
mv ~/.node-gyp/node-v<span class="nv">$NODE_VERSION</span> ~/.node-gyp/<span class="nv">$NODE_VERSION</span>

<span class="c"># 创建一个标记文件</span>
<span class="nb">printf</span> <span class="s2">&quot;9\n&quot;</span>&gt;~/.node-gyp/<span class="nv">$NODE_VERSION</span>/installVersion

<span class="c"># 删除下载下来的源码包</span>
rm -rf node-v<span class="nv">$NODE_VERSION</span>.tar.gz</code></pre></div>

<p>Before we install a npm package, which requires node-gyp, just run it.</p>

<p>Or use <a href="https://www.npmjs.com/package/node-gyp-install">node-gyp-install</a></p>

<p>See other ways in reference.</p>

<h2 id="reference">Reference</h2>

<ul>
  <li><a href="https://breeswish.org/blog/2014/11/14/node-gyp-rebuild-freeze/">node-gyp rebuild 卡住的解决方案</a></li>
</ul>

    </div>
</div>
<div class="card">
    <!-- 多说 start -->
    <div class="ds-thread" data-thread-key="/2015/11/25/node-gyp-rebuild-too-slow" data-title="Node Gyp Rebuild Too Slow" data-url="/2015/11/25/node-gyp-rebuild-too-slow.html"></div>
    <script type="text/javascript" charset="utf-8" src="/js/duoshuo/duoshuo.js"></script>
    <!-- 多说  end  -->
</div>

    <a href="javascript:document.body.scrollIntoView(true)" class="card hover-top">
        <div class="content">
            <div class="date">© Copyright 2011 ~ 2016 by vivaxy</div>
        </div>
    </a>
</div>
</body>
<script type="text/javascript" src="/js/analysis/ba.js"></script>
</html>
