<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0">
    <link rel="shortcut icon" href="/css/vivaxy.icon.png">
    <link type="text/css" rel="stylesheet" href="/css/reset.css">
    <link type="text/css" rel="stylesheet" href="/css/main.css">
    <link type="text/css" rel="stylesheet" href="/css/syntax.css">
    <link rel="alternate" type="application/atom+xml" title="vivaxy blog" href="/atom.xml" />
    <title>用 ECMAScript 6 编写模块化的 js</title>
</head>
<body>
<div class="container">
    <a href="/" class="card hover-left">
	<div class="content">
		<h1>用 ECMAScript 6 编写模块化的 js</h1>
		<div class="date">2015-12-08</div>
	</div>
	<div class="icon-arrow-left"></div>
</a>
<div class="card">
	<div class="content">
		<h2 id="section">阶段一</h2>

<p>用 babel 5.0 的 <a href="https://babeljs.io/docs/setup/#babel_cli">cli</a> 将单个 es6 文件编译成 umd 形式的 es5</p>

<p>将文件拼接在一起 <code>&gt; cat ./build/a.js ./build/b.js &gt; ./dest/index.js</code></p>

<h2 id="writing-modular-javascript-with-ecmascript-6html"><a href="/2015/09/03/writing-modular-javascript-with-ecmascript-6.html">阶段二</a></h2>

<p>使用到了 <a href="https://www.npmjs.com/package/babel">babel</a> 和 <a href="https://www.npmjs.com/package/browserify">browserify</a></p>

<p>用 babel 5.0 的 <a href="https://babeljs.io/docs/setup/#babel_cli">cli</a> 将单个 es6 文件编译成 cmd 形式的 es5</p>

<p>用 browserify 输出为同一个文件</p>

<h2 id="writing-modular-javascript-with-ecmascript-6html-1"><a href="/2015/09/03/writing-modular-javascript-with-ecmascript-6.html">阶段三</a></h2>

<p>使用 browserify 插件 babelify</p>

<p><code>&gt; browserify ./src/index.js -t babelify -o ./dest/index.js</code></p>

<h2 id="section-1">阶段四</h2>

<p>babel 升级到了 6.0 ，对所有功能进行了细化拆分，如果用到 es6 的规范，则需要安装 <code>babel-preset-es2015</code></p>

<p>此处需要对上个阶段的项目进行升级</p>

<p>首先安装依赖</p>

<p><code>npm i --save-dev babelify babel-preset-es2015</code></p>

<p>修改 <code>package.json</code> 添加 browserify 的配置</p>

<div class="highlight"><pre><code class="language-json" data-lang="json"><span class="err">...</span>
<span class="s2">&quot;browserify&quot;</span><span class="err">:</span> <span class="p">{</span>
    <span class="nt">&quot;transform&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">[</span>
            <span class="s2">&quot;babelify&quot;</span><span class="p">,</span>
            <span class="p">{</span>
                <span class="nt">&quot;presets&quot;</span><span class="p">:</span> <span class="p">[</span>
                    <span class="s2">&quot;es2015&quot;</span>
                <span class="p">]</span>
            <span class="p">}</span>
        <span class="p">]</span>
    <span class="p">]</span>
<span class="p">}</span><span class="err">,</span>
<span class="err">...</span></code></pre></div>

<p>编译的指令变成了 <code>browserify ./src/index.js -o ./dest/index.js</code></p>

<p>这里可以把原本的 makefile 去除了，改由 <code>npm run make</code> 命令来执行编译，在 <code>package.json</code> 中添加</p>

<div class="highlight"><pre><code class="language-json" data-lang="json"><span class="err">...</span>
<span class="s2">&quot;scripts&quot;</span><span class="err">:</span> <span class="p">{</span>
    <span class="nt">&quot;build&quot;</span><span class="p">:</span> <span class="s2">&quot;browserify ./src/index.js -o ./dest/index.js&quot;</span>
<span class="p">}</span><span class="err">,</span>
<span class="err">...</span></code></pre></div>

<h2 id="section-2">阶段五</h2>

<p>使用 <a href="https://webpack.github.io/">webpack</a> 和 babel</p>

<p>上个阶段中每次编译的时间都是漫长的，不便于调试，使用 <a href="https://webpack.github.io/docs/webpack-dev-server.html">webpack-dev-server</a> 可以解决调试慢的问题</p>

<p>安装依赖 <code>npm i --save-dev webpack webpack-dev-server babel-loader babel-core babel-preset-es2015</code></p>

<p>项目下新建 webpack 配置文件 <code>webpack.config.js</code></p>

<div class="highlight"><pre><code class="language-json" data-lang="json"><span class="err">/**</span>
 <span class="err">*</span> <span class="err">@since</span> <span class="mi">2015-12-07</span> <span class="mi">16</span><span class="err">:</span><span class="mi">43</span>
 <span class="err">*</span> <span class="err">@author</span> <span class="err">vivaxy</span>
 <span class="err">*/</span>
<span class="err">&#39;use</span> <span class="err">strict&#39;;</span>
<span class="err">module.exports</span> <span class="err">=</span> <span class="p">{</span>
    <span class="err">entry:</span> <span class="err">{</span>
        <span class="err">index:</span> <span class="err">&#39;./src/index.js&#39;</span> <span class="err">//</span> <span class="err">项目主入口文件</span>
    <span class="p">}</span><span class="err">,</span>
    <span class="err">output:</span> <span class="p">{</span>
        <span class="err">filename:</span> <span class="err">&#39;./[name].js&#39;</span> <span class="err">//</span> <span class="err">输出的文件</span>
    <span class="p">}</span><span class="err">,</span>
    <span class="err">module:</span> <span class="p">{</span>
        <span class="err">loaders:</span> <span class="err">[</span>
            <span class="err">{</span>
                <span class="err">test:</span> <span class="err">/src\/.+\.js?$/,</span>
                <span class="err">loader:</span> <span class="err">&#39;babel?presets[]=es2015&#39;</span> <span class="err">//</span> <span class="err">定义了</span> <span class="err">loader</span>
            <span class="p">}</span>
        <span class="err">]</span>
    <span class="err">}</span>
<span class="err">};</span></code></pre></div>

<p>loader 中的配置可以参考<a href="https://webpack.github.io/docs/configuration.html#module-loaders">这里</a></p>

<p>配置完成后，在命令行中执行 <code>&gt; webpack</code> 就能得到输出的文件，执行 <code>&gt; webpack-dev-server</code> 就能在 8080 端口启动本地服务，调试 es6 代码</p>

<p>如果想在文件变动后自动刷新页面，可以在 html 中加入 <code>&lt;script src="http://localhost:8080/webpack-dev-server.js"&gt;&lt;/script&gt;</code></p>

<p><a href="https://github.com/vivaxy/course/tree/gh-pages/hammer">参考项目</a></p>

	</div>
</div>
<div class="card">
	<!-- 多说 start -->
	<div class="ds-thread" data-title="用 ECMAScript 6 编写模块化的 js" data-url=""></div>
	<script type="text/javascript" charset="utf-8" src="/js/duoshuo/duoshuo.js"></script>
	<!-- 多说  end  -->
</div>

    <a href="javascript:document.body.scrollIntoView(true);" class="card hover-top">
        <div class="content">
            <div class="date">© Copyright 2016 by vivaxy</div>
        </div>
    </a>
</div>
</body>
<script type="text/javascript" src="/js/analysis/ba.js"></script>
</html>
